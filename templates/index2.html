<html>
<head>
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="https://raw.github.com/NickQiZhu/dc.js/master/test/dc.css"/>
</head>
<body>
    <div id="chart1"></div>
    <div id="chart2"></div>
    <div id="chart3"></div>
    <div id="chart4"></div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/crossfilter/1.1.3/crossfilter.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.2.2/d3.v3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/dc/1.3.0/dc.min.js"></script>
    <script>
d3.json('/data.json', function (err, data) {
    // 1. Time
    parseDate = d3.time.format("%Y-%m-%d").parse;
    data.forEach(function(d) {
        if (d.dateTime) {
            d.day = parseDate(d.dateTime);
        }

        if (!d.ID) {
            d.ID = 'Dirk';
        }

        // Plot value attribute***
        // ** ID (dirk), 
        // ** Exp (calories spent, calotiesIn), 
        // ** Loc (Pasadena) in the brain 
        // ** Val (calories) 
        // ** Time (day in fitbit)
        // ** Data type
        // Set Location Flag to "Pasadena"
        if (d.name == undefined) {
            if (d.loggedFood) {
                d.name  = d.loggedFood.name;
                d.value = d.loggedFood.calories;
                d.day  = parseDate(d.logDate);
                d.exp   = d.loggedFood.mealtypeID;
                // Compute weekday using JS
            } else {
                d.name = d.type;
                d.value = parseFloat(d.value);
            }
        }
    });
    console.log(data[0]);
    console.log(data[data.length-1]);
    
    cross = crossfilter(data);
    //Summary data by group (crossfilter functions)
    // Group by Time
    d = cross.dimension(function(d) { return d.day; });
    g = d.group().reduceSum(function(d) { return d.calories; });
    dc.lineChart('#chart1')
    .dimension(d)
    .group(g)
    .height(512)
    .width(512)
    .x(d3.time.scale().domain([new Date(2013, 6-1, 1), new Date(2013, 7-1, 1)]))
    .y(d3.scale.linear())
    .elasticY(true);
    
    // Group by Food type
    d = cross.dimension(function(d) { return d.name; });
    g = d.group().reduceSum(function(d) { return 1; });
    dc.pieChart('#chart2')
    .dimension(d)
    .group(g)
    .height(512)
    .width(512);

    d = cross.dimension(function(d) { return d.exp; });
    g = d.group().reduceSum(function(d) { return 1; });
    dc.pieChart('#chart3')
    .dimension(d)
    .group(g)
    .height(512)
    .width(512);
    
    // Group by Location

    dc.renderAll();
});
    </script>
</body>
</html>